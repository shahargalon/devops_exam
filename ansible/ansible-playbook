---
  - hosts: aws_cassandra_cluster
    become: yes
    remote_user: ubuntu
    tasks:  
      - name: add cassandra gpg key to apt
        apt_key:
          url: https://www.apache.org/dist/cassandra/KEYS
          state: present
      
      - name: add cassandra repo tp apt
        apt_repository:
          repo: deb http://www.apache.org/dist/cassandra/debian 40x main
          state: present
          filename: cassandra
       
      - name: install cassandra
        apt:
          name: cassandra
          state: present    
      
      - name: remove cassandra.yaml file
        file:
          state: absent
          path: /etc/cassandra/cassandra.yaml 
EOF     
   
ansible all -b -i '3.64.125.43,' -m copy -a "src=./ansible/cassandra1.yaml dest=~/"
ansible all -b -i 'null,' -m copy -a "src=./ansible/cassandra2.yaml dest=~/"
    
cat <<'EOF' >> ansible-playbook
---
  - hosts: aws_cassandra_cluster
    become: yes
    remote_user: ubuntu
    tasks:
      - name: raplace IP1 on cassandra.yaml file
        replace: 
        path: ~/cassandra.yaml
        regexp: PRIVATE_IP1
        replace: 172.31.34.110

      - name: raplace IP2 on cassandra.yaml file
        replace: 
        path: ~/cassandra.yaml
        regexp: PRIVATE_IP2
        replace: 172.31.43.110  

      - name: copy the cassandra.yaml file
        copy:
        remote_src: yes
          src: ~/cassandra.yaml
          dest: /etc/cassandra/cassandra.yaml

      - name: restart cassandra service
        service:
          name: cassandra
          state: restarted
---
  - hosts: aws_cassandra_cluster
    become: yes
    remote_user: ubuntu
    tasks:  
      - name: add cassandra gpg key to apt
        apt_key:
          url: https://www.apache.org/dist/cassandra/KEYS
          state: present
      
      - name: add cassandra repo tp apt
        apt_repository:
          repo: deb http://www.apache.org/dist/cassandra/debian 40x main
          state: present
          filename: cassandra
       
      - name: install cassandra
        apt:
          name: cassandra
          state: present    
      
      - name: remove cassandra.yaml file
        file:
          state: absent
          path: /etc/cassandra/cassandra.yaml 
EOF     
   
ansible all -b -i '3.64.125.43,' -m copy -a "src=./ansible/cassandra1.yaml dest=~/"
ansible all -b -i 'null,' -m copy -a "src=./ansible/cassandra2.yaml dest=~/"
    
cat <<'EOF' >> ansible-playbook
---
  - hosts: aws_cassandra_cluster
    become: yes
    remote_user: ubuntu
    tasks:
      - name: raplace IP1 on cassandra.yaml file
        replace: 
        path: ~/cassandra.yaml
        regexp: PRIVATE_IP1
        replace: 172.31.34.110

      - name: raplace IP2 on cassandra.yaml file
        replace: 
        path: ~/cassandra.yaml
        regexp: PRIVATE_IP2
        replace: 172.31.43.110  

      - name: copy the cassandra.yaml file
        copy:
        remote_src: yes
          src: ~/cassandra.yaml
          dest: /etc/cassandra/cassandra.yaml

      - name: restart cassandra service
        service:
          name: cassandra
          state: restarted
